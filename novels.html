<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Novels — Elias Marrow</title>
  <link rel="stylesheet" href="styles.css"/>
</head>

<body class="page-novels">
  <div class="container">

    <div class="topbar">
      <div class="brand">
        <div class="sigil">ELIAS MARROW</div>
        <div class="motto">Novels</div>
      </div>
      <div class="nav">
        <a href="index.html">Home</a>
        <a href="essays.html">Essays</a>
        <a href="novels.html">Novels</a>
        <a href="about.html">About</a>
      </div>
    </div>

    <div class="panel soft">
      <h2>Novels</h2>
      <p class="muted">
        Archive editions. Published deliberately, not frequently.
      </p>

      <div class="section-card">
        <div class="section-title">Books</div>
        <div class="muted">Current archive editions</div>
        <div id="books-grid" class="cover-grid"></div>
      </div>

      <div id="book-error" class="section-card" style="display:none;">
        <div class="section-title">Loading error</div>
        <div class="muted" id="book-error-text"></div>
      </div>
    </div>

    <div class="footer">
      <div><a href="index.html">Back to Home</a></div>
      <div>© <span id="year"></span> Elias Marrow</div>
    </div>

  </div>

  <script>
    function showBookError(msg){
      const err = document.getElementById('book-error');
      const txt = document.getElementById('book-error-text');
      if (err && txt){
        err.style.display = 'block';
        txt.textContent = msg;
      }
    }

    function renderBookCard(book){
      const card = document.createElement('div');
      card.className = 'ill-card';

      if (book && book.cover){
        card.style.setProperty('--bgimg', `url("${book.cover}")`);
      }

      const title = (book && book.title) ? book.title : 'Untitled';
      const subtitle = (book && book.subtitle) ? book.subtitle : '';

      card.innerHTML = `
        <a href="read-me.html?type=book&id=${book.id}" rel="noopener">
          <h3 class="ill-title">${title}</h3>
          ${subtitle ? `<p class="ill-meta">${subtitle}</p>` : ``}
        </a>
      `;
      return card;
    }

    // cache-buster (kept as-is)
    const url = 'content.json?v=' + Date.now();

    fetch(url, { cache: 'no-store' })
      .then(r => r.json())
      .then(data => {
        if (!data || !Array.isArray(data.books)){
          showBookError('books[] not found in content.json');
          return;
        }

        const grid = document.getElementById('books-grid');
        if (!grid) return;

        data.books.forEach(b => grid.appendChild(renderBookCard(b)));
      })
      .catch(() => showBookError('Could not load content.json'));

    document.getElementById("year").textContent = new Date().getFullYear();
  </script>

</body>
</html>
